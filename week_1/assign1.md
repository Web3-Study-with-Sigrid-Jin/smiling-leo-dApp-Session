# Dapp 개발은 어떻게 할까?

### dapp 개발은 크게 컨트랙트 코드 작성, 배포, 프론트엔드와의 통신으로 이루어진다.

![이미지 이름](img/overview.png)

## 컨트랙트 코드 작성
###     dapp 을 만들기 위해서는 솔리디티로 컨트랙트 코드를 작성해야 한다. 솔리디티는 새로운 언어이기 때문에 기존 IDE에서 지원을 안하는 경우가 있다. 그래서 이에 맞춘 IDE를 써야하는데, 대표적인 두 IDE가 바로 Truffle과 Hardhat이다. 

### Hardhat은 이더리움 기반 소프트웨어를 compile, deploy, test, debug 허가 위한 IDE이다. 로컬에 이더리움 네트워크인 하드햇 네트워크가 내장되어 있다는 것이 특징이다. 또한 다양한 기능들에 대한 튜토리얼을 제공하기 때문에 dapp 개발을 처음 시작하는 사람들에게 추천한다.

### Truffle도 마찬가지로 이더리움 기반 소프트웨어를 개발하기 위한 IDE이다. interactive console을 지원하여 직접적인 계약 통신을 지원하는 것이 특징이다.

### Truffle의 경우 직접적으로 컨트랙트와 상호작용 하기 위해서는 Ganache CLI 나 Gahance UI를 설치해야한다. 로컬에서 블록체인을 상요하기 위해서도 마찬가지다. 하지만 Hardhat은 이를 단일 패키지로 제공하기 때문에 이를 사용하는 것을 좀 더 추천한다.


### 코드 작성에 있어 여러 라이브러리를 사용해야 할텐데, 이중 대표적인 것이 Web3.js와 Ethers.js 이다.​
![이미지 이름](img/Wed3js구조도.jpg)

### Web3.js 는 내부에서 HTTP나 IPC를 통해서 JSON RPC API 를 호출하도록 되어있다. 이더리움의 각 노드들은 JSON-RPC로만 소통할 수 있기 때문에, web3.js는 쉽고 편리하게 자바스크립트 인터페이스로 상호작용할 수 있도록 해 준다. 

### Ethers.js 는 이더리움 블록체인 생태계와 상호작용하기 위한 라이브러리이다. 원래는  ethers.io 와 함께 사용하도록 설계되었으며 이후 더 범용 라이브러리로 확장되었다.

## 컨트랙트 코드 배포
### 작성한 코드를 배포 하기 위해서는 먼저 작성된 코드를 컴파일 해야 한다. 컴파일을 하게되면 bytecode와 ABI가 나오게 된다. bytecode는 말 그대로 코드를 EVM이 읽을수 있게 만든 것이고, ABI는 작성된 코드에서의 컨트랙트 함수와 매개변수들을 JSON 형식으로 나타낸 리스트다. ABI는 컨트랙트 내의 어떤 함수를 호춣할지를 결정하는데 필요하다. 

### 이렇게 컴파일 된 코드는 블록체인 위에 기록되어야 하는데, 실제 네트워크에 연결된 로컬 노드에서 개발 및 배포를 하는 것은 유지보수 관점에서 많은 어려움이 있기 때문에, Node Provider를 사용한다. Node Provider는 실제 네트워크와 동일한 API를 제공하므로, 우리는 request를 로컬에 보내는 대신  Node Provider에 보냄으로써 실제 네트워크에서의 개발, 배포를 쉽게 할 수 있다. 이러한 Node Provider에는 AllThatNode, Infura, Alchemy가 있다. 국내에서는  AllThatNode가 제일 큰 규모의 Node Provider이다. 

## 프론트엔드와의 통신
### 기존에 우리가 통신을 할때는 Client는 가 요청을 서버에 보내면 Server는 요청한 내용을 실행하고 결과값을 반환한다. 이러한 반환을 Client는 받는다. 이렇게 기존에 통신을 하는 것은 중앙화된 서버가 존재하기 때문에 효율적이었다. 하지만 블록체인 서버, 즉 분산 네트워크 환경에서는 이것이 어렵기 때문에 좀 더 쉬운 방법이 필요했는데 이것이 바로 RPC 이다. RPC는 프로그램이 별도의 주소 공간에서 서브루틴을 실행하는 프로세스를 나타낸다. RPC가 실행되면 서로 다른 주소 공간 간에 요청과 응답이 발생한다. 간단하게 말해 원격에 있는 프로시저를 호출하여 응답을 보내는 것을 뜻한다고 생각하면 될 것같다. 이러한 RPC를 사용할 노드가 필요한데, 이를 RPC 노드라고 한다. RPC 노드는 블록체인 데이터를 읽고 트랜잭션을 다른 네트워크로 보낼 수 있다. 즉 dapp 에서 사용자- 프론트엔드와 통신하기 위해서 필수적이다. 위에서 언급한 Node Provider가 이 노드를 제공한다.
![이미지 이름](img/rpc.png)

### validator는 블록체인에서 새로 생성된 블록의 무결성을 검증하는 노드를 말한다. 퍼블릭 블록체인은 누구나 validator가 되어 네트워크 유지 및 관리에 참여할 수 있다. 블록체인에서 이뤄진 모든 거래 정보를 전부 저장하는 validator는은 풀노드라고 한다. 이러한 validator는 DSRV, Orion Money 등이 있다.

### 마지막으로 이렇게 만들어진 dapp에서는 여러 트랜잭션이 발생하는데, 이를 확인하기 위해서 explorer가 필요하다. explorer에서는 블록 생성내역, 트랜잭션 조회, 지갑정보 조회, 토큰 검색 등을 할 수 있다. 이더리움에서는 Etherscan 을 사용한다.